{% import "opt.proto.j2" as opts %}

{% macro render_field(field, file, package) %}
  {{ field.kind }}{{ field.field_type.render_name(file, package) }} {{ field.name }} = {{ field.tag }}
  {%- if !field.options.is_empty() -%}
     {{ " " }}{% call opts::field_opts(&field.options) %}
  {%- endif -%};
{% endmacro %}

message {{ name }} {
  {%- for enum_ in enums %}
    {{ enum_ }}
  {%- endfor -%}

  {%- for nested_msg in messages -%}
    {{ nested_msg.render()? | indent(2) }}
  {%- endfor -%}

  {%- for oneof in oneofs %}
  oneof {{ oneof.name }} {
    {% call opts::get_options(&oneof.options) %}

    {% for field in oneof.fields %}
      {% call render_field(field, file.as_ref(), package.as_ref()) %}
    {% endfor %}
  }
  {%- endfor -%}

  {% for field in fields %}
    {% call render_field(field, file.as_ref(), package.as_ref()) %}
  {%- endfor %}
}
