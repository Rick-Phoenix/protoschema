syntax = "proto3";

package myapp.v1;

import "google/protobuf/timestamp.proto";
import "myapp/v2/post.proto";
import "buf/validate/validate.proto";
import "google/protobuf/descriptor.proto";

option string_opt = "abcde";

option duration_opt = { seconds: 3600, nanos: 0 };

option enum_value = UNSPECIFIED;

option message_option = {
  subject: "hobbits", 
  location: "isengard" 
};

option example = {
  num_list: [ 1, 2, 4, 5], 
  string_list: [
    "hello", 
    "there", 
    "general", 
    "kenobi"
  ], 
  list_of_messages: [
    {
      name: "cats", 
      are_cute: true 
    }, 
    {
      name: "dogs", 
      are_cute: true 
    }
  ] 
};

extend google.protobuf.MessageOptions {
  string my_custom_message_option = 1565;
}

extend google.protobuf.FileOptions {
  string my_custom_file_option = 1565;
}


enum user_status {
  reserved 405;
  reserved 200 to 205;

  option allow_alias = true;

  USER_STATUS_UNSPECIFIED = 0;
  USER_STATUS_ACTIVE = 1 [
    example = {
      num_list: [ 1, 2, 4, 5], 
      string_list: [
        "hello", 
        "there", 
        "general", 
        "kenobi"
      ], 
      list_of_messages: [
        {
          name: "cats", 
          are_cute: true 
        }, 
        {
          name: "dogs", 
          are_cute: true 
        }
      ] 
    }
  ];
  USER_STATUS_INACTIVE = 2;
  USER_STATUS_PASSIVE = 2;
}

enum referrers {

  REFERRERS_UNSPECIFIED = 0;
  REFERRERS_GITHUB = 1;
  REFERRERS_REDDIT = 2;
}

message User {
  reserved "one", "two";
  reserved 405;
  reserved 200 to 205;

  option (buf.validate.message) = {
    cel: [
      {
        id: "passwords_match", 
        message: "the passwords do not match", 
        expression: "this.password == this.repeated_password" 
      }
    ] 
  };

  option example = {
    num_list: [ 1, 2, 4, 5], 
    string_list: [
      "hello", 
      "there", 
      "general", 
      "kenobi"
    ], 
    list_of_messages: [
      {
        name: "cats", 
        are_cute: true 
      }, 
      {
        name: "dogs", 
        are_cute: true 
      }
    ] 
  };

  enum tier {
    reserved "one", "two";
    reserved 405;
    reserved 200 to 205;

    option example = {
      num_list: [ 1, 2, 4, 5], 
      string_list: [
        "hello", 
        "there", 
        "general", 
        "kenobi"
      ], 
      list_of_messages: [
        {
          name: "cats", 
          are_cute: true 
        }, 
        {
          name: "dogs", 
          are_cute: true 
        }
      ] 
    };

    TIER_UNSPECIFIED = 0;
    TIER_SILVER = 1;
    TIER_GOLD = 2;
  }

  enum favorite_category {

    FAVORITE_CATEGORY_UNSPECIFIED = 0;
    FAVORITE_CATEGORY_PETS = 1;
    FAVORITE_CATEGORY_COOKING = 2;
  }


  oneof activity {
    user_status user_current_status = 102;

    google.protobuf.Timestamp account_deletion_date = 103;
  }


  oneof contact {
    option example = {
      num_list: [ 1, 2, 4, 5], 
      string_list: [
        "hello", 
        "there", 
        "general", 
        "kenobi"
      ], 
      list_of_messages: [
        {
          name: "cats", 
          are_cute: true 
        }, 
        {
          name: "dogs", 
          are_cute: true 
        }
      ] 
    };

    string email = 11 [
      (buf.validate.field) = {
        string: {
          email: true 
        } 
      }
    ];

    referrers referrer = 12;
  }


  uint64 id = 1 [
    (buf.validate.field) = {
      uint64: {
        gt: 0 
      } 
    }
  ];

  repeated User best_friend = 2;

  string password = 3 [
    (buf.validate.field) = {
      string: {
        min_len: 8 
      } 
    }
  ];

  string repeated_password = 4 [
    (buf.validate.field) = {
      string: {
        min_len: 8 
      } 
    }
  ];

  user_status last_status = 5 [
    (buf.validate.field) = {
      enum: {
        defined_only: true 
      } 
    }
  ];

  map<int32, user_status> last_30_days_statuses = 6 [
    (buf.validate.field) = {
      map: {
        min_pairs: 30, 
        keys: {
          int32: {
            lt: 31 
          } 
        }, 
        values: {
          enum: {
            defined_only: true 
          } 
        } 
      } 
    }
  ];

  map<uint64, User> friends = 7;

  myapp.v2.Post last_post = 8;

  myapp.v2.post_status last_post_status = 9;

  myapp.v2.Post.Metadata last_post_metadata = 10;

  google.protobuf.Timestamp created_at = 100;

  google.protobuf.Timestamp updated_at = 101;
}

message Section {

  message Subsection {

    option example = {
      num_list: [ 1, 2, 4, 5], 
      string_list: [
        "hello", 
        "there", 
        "general", 
        "kenobi"
      ], 
      list_of_messages: [
        {
          name: "cats", 
          are_cute: true 
        }, 
        {
          name: "dogs", 
          are_cute: true 
        }
      ] 
    };

    message SubSubsection {


      uint64 id = 1;

      string name = 2;

      myapp.v2.Post.post_category category = 3;
    }


    string name = 1;

    myapp.v2.Post top_trending_post = 2;
  }

}

service MyService1 {
  option example = {
    num_list: [ 1, 2, 4, 5], 
    string_list: [
      "hello", 
      "there", 
      "general", 
      "kenobi"
    ], 
    list_of_messages: [
      {
        name: "cats", 
        are_cute: true 
      }, 
      {
        name: "dogs", 
        are_cute: true 
      }
    ] 
  };

  rpc Handler1 (User) returns (Section) {
    option example = {
      num_list: [ 1, 2, 4, 5], 
      string_list: [
        "hello", 
        "there", 
        "general", 
        "kenobi"
      ], 
      list_of_messages: [
        {
          name: "cats", 
          are_cute: true 
        }, 
        {
          name: "dogs", 
          are_cute: true 
        }
      ] 
    };
  };

  rpc Handler2 (myapp.v2.Post) returns (myapp.v2.Post.Metadata);
}
